# docker-container-healthchecker

Runs healthchecks against local docker containers

## Requirements

- golang 1.19+

## Usage

After creating an app.json file, execute the healthchecker like so:

```shell
# docker-container-healthchecker check $CONTAINER_ID_OR_NAME
docker-container-healthchecker check cb0ce984f2aa
```

By default, the checks specified for the `web` process type are executed. If the process-type has no checks specified, a default `uptime` container check of 10 seconds is performed.

## File Format

Healthchecks are defined within a json file and have the following properties:

- `attempts`: (default: `3`, unit: seconds) Number of retry attempts to perform on failure
- `command`: (default: `""` (none)) Command to execute within container
    - Errata: This property cannot be specified if the healthcheck also has either a `path` or `uptime` property specified
- `initialDelay`: (default: `0`, unit: seconds) Number of seconds to wait after a container has started before triggering the healthcheck
- `name`: (default: `""` (autogenerated)) The name of the healthcheck. If unspecified, it will be autogenerated from the rest of the healthcheck information.
- `path`: (default: `/` (if no command specified)) An http path to check.
    - Errata: This property cannot be specified if the healthcheck also has either a `command` or `uptime` property specified
- `type`: (default: `""` (none), options: liveness, readiness, startup) Type of the healthcheck.
- `uptime`: (default: `""` (none) ) Amount of time the container must be alive before the container is considered healthy. Any restarts will cause this to check to fail, and this check does not respect retries.
    - Errata: This property cannot be specified if the healthcheck also has either a `command` or `path` property specified
- `wait`: (default: `5`, unit: seconds): Number of seconds to wait before timing out a healthcheck.

> Any extra properties are ignored

Healthchecks are specified within an `app.json` file grouped in a per process-type basis. One process type can have one or more healthchecks of various types.

```json
{
  "healthchecks": {
    "web": [
        {
            "type":        "startup",
            "name":        "web check",
            "description": "Checking if the app responds to the /health/ready endpoint",
            "path":        "/health/ready",
            "attempts": 3
        }
    ]
}
```

An example `app.json` is located in the root of this repository.
